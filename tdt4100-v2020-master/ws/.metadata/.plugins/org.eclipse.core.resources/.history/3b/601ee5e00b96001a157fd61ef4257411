package EksamenKont2015;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Iterator;
import java.util.List;

public class ValuesSeries implements Values {

	 private List<Value> valueSeries = new ArrayList<>();
	 private final Unit unit;	 
	 
	/**
     * Constructs a new ValueSeries object, with the provided Unit.
     * @param unit
     */
    public ValuesSeries(Unit unit) {
        this.unit=unit;
    }
  
    /**
     * Appends the provided double to this ValueSeries. The double value is assumed to be in the Unit of this ValueSeries.
     * @param value the double to append
     */
    public void appendValue(double value) {
    	if(!valueSeries.contains(new Value(this.unit, value))) {
    		valueSeries.add(new Value(this.unit,value));
    	}
    }
    /**
     * Appends the provided Value to this ValueSeries, by first converting it to this ValueSeries' unit and then appending it.
     * @param value the Value to append, after converting it to this ValueSeries' Unit.
     */
    public void appendValue(Value value) {
    	appendValue(checkUnitAndReturnRightValue(value));
    }
    
    
    private double checkUnitAndReturnRightValue(Value value) {
    	if(value.getUnit()==this.unit) {
    		return value.getValue();
    	}else {
    		double convertedValue =  value.getUnit().convert(value.getValue(), this.unit);
    		return convertedValue;
    	}
    }
   
	@Override
	public Iterator<Double> iterator() {
		return new IterateValuesSeries(this.valueSeries);
	}

	class IterateValuesSeries implements Iterator<Double>{

		private List<Value> valuesToIterate;
		private int count=0;
				
		public IterateValuesSeries(List<Value> valuesToIterate) {
			this.valuesToIterate=valuesToIterate;
		}
		
		@Override
		public boolean hasNext() {
			return count<valuesToIterate.size()-1;
		}

		@Override
		public Double next() {
			return this.valuesToIterate.get(count++).getValue();
		}	
	}
	
	@Override
	public Unit getUnit() {
		return this.unit;
	}

	@Override
	public int size() {
		return valueSeries.size();
	}

	@Override
	public double average() {	
		double sum=0;
		for(Value value:this.valueSeries) {
			sum+=value.getValue();
		}
		return sum;
	}
	
	//Jeg tenker også på ulike størrelser på listene jeg skal sammenligne
	@Override
	public Values add(Values other) {
		if(this.size()<other.size()) {
			return other;
		}else {
			return this;
		}
	}

	
	private Collection<ValuesListener> listeneres = new ArrayList<>();
	
	@Override
	public void addValueListener(ValuesListener listener) {
		if(!this.listeneres.contains(listener)) {
			this.listeneres.add(listener);		}
		
	}

	@Override
	public void removeValueListener(ValuesListener listener) {
		this.listeneres.remove(listener);
	}
    
}
